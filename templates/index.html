<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HooperDNA | Find NBA Match</title>

    <link rel="icon" href="https://i.ibb.co/yXcbqyv/favicon-16x16.png" type="image/png">

    <!-- Import Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Oswald', sans-serif;
            background-color: #272727;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: url('https://i.ibb.co/Xpfm776/collegemashblue.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat; 
        }
        .logo-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-container img {
            max-height: 180px;
            width: auto;
            height: auto;
            margin-bottom: 20px;
        }

        .container {
            text-align: center;
            background-color: rgb(24, 24, 24);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 400px;
        }

        h1 {
            margin-top: -10px;
            margin-bottom: 20px;
            font-size: 34px;
            color: #ffffff;
        }

        .dropdown-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .dropdown-list {
            position: absolute;
            z-index: 1;
            max-height: 200px;
            overflow-y: auto;
            background-color: #ffffff;
            border: 1px solid #ddd;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }

        .dropdown-list div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .dropdown-list div:hover {
            background-color: #f0f0f0;
        }

        #player-input, #selected_profile {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 18px;
            font-family: 'Oswald', sans-serif;
        }

        #selected_profile {
            font-family: 'Oswald', sans-serif;
            background-color: #ffffff;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 21px;
            cursor: pointer;
            font-family: 'Oswald', sans-serif;
        }

        button:hover {
            background-color: #0056b3;
        }

        .google-doc-btn {
            margin-top: 15px;
            background-color: #28a745;
        }

        .google-doc-btn:hover {
            background-color: #218838;
        }

    </style>
</head>
<body>

    <div class="logo-container">
        <img src="https://i.ibb.co/3SvXSwQ/Hooper-DNA-1-removebg.png" alt="Hooper-DNA-logo" border="0" style="height: 190px; width: auto; display: block;">
    
        <div class="container">
            <h1>Player Search</h1>

            <!-- Player search form -->
            <form id="playerForm" method="POST" action="/submit">
                <div class="dropdown-container">
                    <input type="text" id="player-input" placeholder="Start typing a player's name..." autocomplete="off">
                    <div id="dropdown-list" class="dropdown-list" style="display:none;"></div>
                </div>

                <!-- Hidden field for player ID -->
                <input type="hidden" id="player_id" name="player_id">

                <select id="selected_profile" name="selected_profile">
                    <option value="offense">Offense</option>
                    <option value="defense">Defense</option>
                    <option selected value="balanced">Balanced</option>
                </select>

                <!-- Submit button -->
                <button type="submit" formmethod="post">Find DNA Match</button>
            </form>

            <!-- Google Doc button -->
            <a href="https://docs.google.com/document/d/16ZT--az650_cqev4-6eHGdSkLtlgf3suRpujZgElr_k/edit?usp=sharing" target="_blank">
                <button class="google-doc-btn">G-Documentation</button>
            </a>

            <br>

            <span style="color: white; font-weight: bold; text-align: center; display: block; font-family: 'Oswald', sans-serif; margin-top: 15px;">
                Please allow up to 15 seconds for your comparison to load...
              </span>

        </div>
    </div>

    <script>
        console.log('JavaScript loaded');
        let playersData = [];
        let filteredPlayers = [];

        // Fetching player data on page load
        window.onload = async function() {
            try {
                const response = await fetch('./static/players.json');  // Update with actual path to your JSON file
                if (!response.ok) {
                    throw new Error(`Failed to fetch player data: ${response.statusText}`);
                }
                playersData = await response.json();
                console.log('Players data loaded successfully:', playersData);
            } catch (error) {
                console.error('Error loading players data:', error);
            }
        };

        // Search and filter player names as user types
        document.getElementById('player-input').addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const dropdown = document.getElementById('dropdown-list');

            // Filter players based on the input
            filteredPlayers = playersData.filter(player => player.name.toLowerCase().includes(query));

            // Clear previous results
            dropdown.innerHTML = '';

            if (filteredPlayers.length > 0) {
                dropdown.style.display = 'block';
                filteredPlayers.slice(0, 10).forEach(player => {  // Limit to top 10 matches
                    const div = document.createElement('div');
                    div.textContent = player.name;
                    div.dataset.playerId = player.id;  // Store player ID in data attribute
                    div.addEventListener('click', () => selectPlayer(player));
                    dropdown.appendChild(div);
                });
            } else {
                dropdown.style.display = 'none';
            }
        });

        // Select a player and update the hidden input with the player ID
        function selectPlayer(player) {
            document.getElementById('player-input').value = player.name;
            document.getElementById('player_id').value = player.id;
            console.log('Selected Player ID:', player.id);
            document.getElementById('dropdown-list').style.display = 'none';
        }

        // Handle form submission
        let isSubmitting = false;

        document.getElementById('playerForm').addEventListener('submit', function(e) {
            console.log('Submit event captured!');
            
            // No need to preventDefault here; we allow the form to submit as usual
            if (isSubmitting) {
                return;  // Prevent multiple submissions
            }

            isSubmitting = true;  // Set the flag to true to indicate the form is being submitted

            const playerId = document.getElementById('player_id').value;
            const selected_profile = document.getElementById('selected_profile').value;

            if (!playerId) {
                alert('Please select a player before submitting.');
                isSubmitting = false;  // Reset the flag if validation fails
                return;  // Prevent form submission if validation fails
            }

            console.log('Form data is valid, allowing normal submission.');
            // The form will now be submitted naturally, and Flask will handle the redirect
            isSubmitting = false;  // Reset the flag after submission (form will submit naturally)
        });




    </script>

</body>
</html>
